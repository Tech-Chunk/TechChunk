import{p as h}from"./parse.bee59afc.js";import{c as b}from"./singletons.f85dc50f.js";const g=b("invalidate_all"),E=b("apply_action");function A(t){const o=JSON.parse(t);return o.data&&(o.data=h(o.data)),o}function w(t){return HTMLElement.prototype.cloneNode.call(t)}function D(t,o=()=>{}){const c=async({action:e,result:r,reset:n})=>{r.type==="success"&&(n!==!1&&HTMLFormElement.prototype.reset.call(t),await g()),(location.origin+location.pathname===e.origin+e.pathname||r.type==="redirect"||r.type==="error")&&E(r)};async function s(e){var m,d,f;e.preventDefault();const r=new URL((m=e.submitter)!=null&&m.hasAttribute("formaction")?e.submitter.formAction:w(t).action),n=new FormData(t),l=(d=e.submitter)==null?void 0:d.getAttribute("name");l&&n.append(l,((f=e.submitter)==null?void 0:f.getAttribute("value"))??"");const u=new AbortController;let p=!1;const y=await o({action:r,cancel:()=>p=!0,controller:u,get data(){return n},formData:n,get form(){return t},formElement:t,submitter:e.submitter})??c;if(p)return;let i;try{const a=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:n,signal:u.signal});i=A(await a.text()),i.type==="error"&&(i.status=a.status)}catch(a){if((a==null?void 0:a.name)==="AbortError")return;i={type:"error",error:a}}y({action:r,get data(){return n},formData:n,get form(){return t},formElement:t,update:a=>c({action:r,result:i,reset:a==null?void 0:a.reset}),result:i})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",s)}}}export{E as a,D as e};
